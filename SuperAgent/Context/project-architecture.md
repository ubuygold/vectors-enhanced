# é¡¹ç›®æ¶æ„

## æ–‡ä»¶ç»“æ„
```
vectors-enhanced/
â”œâ”€â”€ index.js              # ä¸»å…¥å£æ–‡ä»¶ (5000+è¡Œï¼ŒUIé€»è¾‘é€æ­¥è¿ç§»è‡³ src/ui/ æ¨¡å—)
â”œâ”€â”€ webllm.js            # WebLLM å¼•æ“é€‚é…å™¨
â”œâ”€â”€ settings.html        # è®¾ç½®ç•Œé¢ (500+è¡Œï¼Œå¾…æ¨¡å—åŒ–)
â”œâ”€â”€ style.css            # æ ·å¼æ–‡ä»¶ (å¾…ä¼˜åŒ–)
â”œâ”€â”€ manifest.json        # æ‰©å±•é…ç½®æ–‡ä»¶
â”œâ”€â”€ package.json         # Node.js é¡¹ç›®é…ç½® (æ–°å¢)
â”œâ”€â”€ webpack.config.js    # Webpack æ„å»ºé…ç½® (æ–°å¢)
â”œâ”€â”€ .gitignore          # Git å¿½ç•¥æ–‡ä»¶ (æ›´æ–°)
â”œâ”€â”€ src/                 # é‡æ„åçš„æºä»£ç ç›®å½• (æ–°å¢)
â”‚   â”œâ”€â”€ README.md        # æºä»£ç ç›®å½•è¯´æ˜
â”‚   â”œâ”€â”€ index.js        # æ¨¡å—åŒ–å…¥å£æ–‡ä»¶ (æ–°å¢)
â”‚   â”œâ”€â”€ core/           # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ entities/   # å®ä½“ç±»å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ Content.js      # å†…å®¹å®ä½“ç±» (æ–°å¢)
â”‚   â”‚   â”‚   â”œâ”€â”€ Vector.js       # å‘é‡å®ä½“ç±» (æ–°å¢)
â”‚   â”‚   â”‚   â”œâ”€â”€ Task.js         # ä»»åŠ¡å®ä½“ç±» (æ–°å¢)
â”‚   â”‚   â”‚   â””â”€â”€ README.md
â”‚   â”‚   â”œâ”€â”€ extractors/ # å†…å®¹æå–å™¨ (æ–°å¢)
â”‚   â”‚   â”‚   â”œâ”€â”€ IContentExtractor.js    # æå–å™¨æ¥å£ (æ–°å¢)
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatExtractor.js        # èŠå¤©æ¶ˆæ¯æå–å™¨ (æ–°å¢)
â”‚   â”‚   â”‚   â”œâ”€â”€ FileExtractor.js        # æ–‡ä»¶æå–å™¨ (æ–°å¢)
â”‚   â”‚   â”‚   â”œâ”€â”€ WorldInfoExtractor.js   # ä¸–ç•Œä¿¡æ¯æå–å™¨ (æ–°å¢)
â”‚   â”‚   â”‚   â””â”€â”€ README.md
â”‚   â”‚   â”œâ”€â”€ tasks/      # ä»»åŠ¡ç³»ç»Ÿ (æ–°å¢)
â”‚   â”‚   â”‚   â”œâ”€â”€ ITask.js                # ä»»åŠ¡æ¥å£ (æ–°å¢)
â”‚   â”‚   â”‚   â”œâ”€â”€ BaseTask.js             # åŸºç¡€ä»»åŠ¡ç±» (æ–°å¢)
â”‚   â”‚   â”‚   â”œâ”€â”€ VectorizationTask.js    # å‘é‡åŒ–ä»»åŠ¡ (æ–°å¢)
â”‚   â”‚   â”‚   â”œâ”€â”€ TaskFactory.js          # ä»»åŠ¡å·¥å‚ (æ–°å¢)
â”‚   â”‚   â”‚   â”œâ”€â”€ taskTypes.js            # ä»»åŠ¡ç±»å‹å¸¸é‡ (æ–°å¢)
â”‚   â”‚   â”‚   â””â”€â”€ README.md
â”‚   â”‚   â””â”€â”€ plugins/    # æ’ä»¶ç³»ç»Ÿ (Phase 8 - è®¡åˆ’ä¸­)
â”‚   â”‚       â”œâ”€â”€ IVectorizationPlugin.js # æ’ä»¶æ¥å£å®šä¹‰
â”‚   â”‚       â”œâ”€â”€ PluginManager.js        # æ’ä»¶ç®¡ç†å™¨
â”‚   â”‚       â””â”€â”€ PluginLoader.js         # æ’ä»¶åŠ è½½å™¨
â”‚   â”œâ”€â”€ application/    # åº”ç”¨å±‚æœåŠ¡ (æ–°å¢)
â”‚   â”‚   â”œâ”€â”€ TaskManager.js              # ä»»åŠ¡ç®¡ç†å™¨ (æ–°å¢)
â”‚   â”‚   â””â”€â”€ TaskQueue.js                # ä»»åŠ¡é˜Ÿåˆ— (æ–°å¢)
â”‚   â”œâ”€â”€ infrastructure/ # åŸºç¡€è®¾æ–½å±‚
â”‚   â”‚   â”œâ”€â”€ ConfigManager.js            # é…ç½®ç®¡ç†å™¨ (æ–°å¢)
â”‚   â”‚   â”œâ”€â”€ events/    # äº‹ä»¶ç³»ç»Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ EventBus.js             # äº‹ä»¶æ€»çº¿ (æ–°å¢)
â”‚   â”‚   â”‚   â”œâ”€â”€ eventBus.instance.js    # äº‹ä»¶æ€»çº¿å®ä¾‹ (æ–°å¢)
â”‚   â”‚   â”‚   â””â”€â”€ README.md
â”‚   â”‚   â”œâ”€â”€ storage/   # å­˜å‚¨é€‚é…å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ StorageAdapter.js       # å‘é‡å­˜å‚¨APIé€‚é…å™¨ (æ–°å¢)
â”‚   â”‚   â”‚   â””â”€â”€ TaskStorageAdapter.js   # ä»»åŠ¡å­˜å‚¨é€‚é…å™¨ (æ–°å¢)
â”‚   â”‚   â””â”€â”€ api/       # APIé€‚é…å™¨
â”‚   â”‚       â””â”€â”€ VectorizationAdapter.js  # å°è£…æ‰€æœ‰å‘é‡åŒ–æºçš„è°ƒç”¨ (æ–°å¢)
â”‚   â”œâ”€â”€ utils/         # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ hash.js      # å“ˆå¸Œè®¡ç®—å·¥å…· (æ–°å¢)
â”‚   â”‚   â”œâ”€â”€ textChunking.js  # æ–‡æœ¬åˆ†å—å·¥å…· (æ–°å¢)
â”‚   â”‚   â”œâ”€â”€ contentFilter.js  # å†…å®¹è¿‡æ»¤å·¥å…· (æ–°å¢)
â”‚   â”‚   â”œâ”€â”€ tagExtractor.js  # æ ‡ç­¾æå–æ ¸å¿ƒæ¨¡å— (æ–°å¢)
â”‚   â”‚   â”œâ”€â”€ tagScanner.js  # æ ‡ç­¾æ‰«ææ¨¡å— (æ–°å¢)
â”‚   â”‚   â”œâ”€â”€ tagParser.js   # æ ‡ç­¾è§£æå·¥å…· (æ–°å¢)
â”‚   â”‚   â”œâ”€â”€ chatUtils.js   # èŠå¤©æ¶ˆæ¯ç»Ÿä¸€è¿‡æ»¤å·¥å…· (æ–°å¢)
â”‚   â”‚   â””â”€â”€ README.md
â”‚   â”œâ”€â”€ ui/            # UIç›¸å…³æ¨¡å— (æ–°å¢)
â”‚   â”‚   â”œâ”€â”€ domUtils.js  # DOMæ“ä½œå·¥å…· (æ–°å¢ï¼ŒåŒ…å«æ–‡ä»¶ä¸‹è½½ç­‰åŸç”ŸDOMæ“ä½œ)
â”‚   â”‚   â”œâ”€â”€ settingsManager.js  # è®¾ç½®ç®¡ç†å™¨ (æ–°å¢ï¼Œé›†ä¸­ç®¡ç†æ‰€æœ‰è®¾ç½®UIåˆå§‹åŒ–)
â”‚   â”‚   â””â”€â”€ components/  # å¯å¤ç”¨UIç»„ä»¶ (æ–°å¢)
â”‚   â”‚       â”œâ”€â”€ ChatSettings.js      # èŠå¤©è®¾ç½®UIç»„ä»¶ (æ–°å¢)
â”‚   â”‚       â”œâ”€â”€ TagRulesEditor.js    # æ ‡ç­¾è§„åˆ™ç¼–è¾‘å™¨UIç»„ä»¶ (æ–°å¢)
â”‚   â”‚       â”œâ”€â”€ TaskList.js          # ä»»åŠ¡åˆ—è¡¨UIç»„ä»¶ (æ–°å¢)
â”‚   â”‚       â”œâ”€â”€ FileList.js          # æ–‡ä»¶åˆ—è¡¨UIç»„ä»¶ (æ–°å¢)
â”‚   â”‚       â”œâ”€â”€ WorldInfoList.js     # ä¸–ç•Œä¿¡æ¯åˆ—è¡¨UIç»„ä»¶ (æ–°å¢)
â”‚   â”‚       â”œâ”€â”€ TagUI.js             # æ ‡ç­¾ç›¸å…³UIé€»è¾‘ç®¡ç† (æ–°å¢)
â”‚   â”‚       â”œâ”€â”€ MessageUI.js         # æ¶ˆæ¯ç›¸å…³UIé€»è¾‘ç®¡ç† (æ–°å¢)
â”‚   â”‚       â”œâ”€â”€ ActionButtons.js     # åŠ¨ä½œæŒ‰é’®ç®¡ç† (Phase 7.1 - å·²å®Œæˆ)
â”‚   â”‚       â”œâ”€â”€ SettingsPanel.js     # è®¾ç½®é¢æ¿æ¶æ„ (Phase 7.2 - å·²å®Œæˆ)
â”‚   â”‚       â”œâ”€â”€ VectorizationSettings.js  # å‘é‡åŒ–è®¾ç½® (Phase 7.2 - å·²å®Œæˆ)
â”‚   â”‚       â”œâ”€â”€ QuerySettings.js     # æŸ¥è¯¢è®¾ç½® (Phase 7.2 - å·²å®Œæˆ)
â”‚   â”‚       â”œâ”€â”€ InjectionSettings.js # æ³¨å…¥è®¾ç½® (Phase 7.2 - å·²å®Œæˆ)
â”‚   â”‚       â”œâ”€â”€ ContentSelectionSettings.js # å†…å®¹é€‰æ‹©è®¾ç½® (Phase 7.2 - å·²å®Œæˆ)
â”‚   â”‚       â”œâ”€â”€ ProgressManager.js   # è¿›åº¦ç®¡ç†å™¨ (Phase 7.3 - å·²å®Œæˆ)
â”‚   â”‚       â”œâ”€â”€ NotificationManager.js # é€šçŸ¥ç®¡ç†å™¨ (Phase 7.6 - å·²å®Œæˆ)
â”‚   â”‚       â””â”€â”€ README.md
â”‚   â”‚   â”œâ”€â”€ EventManager.js      # UIäº‹ä»¶åè°ƒå™¨ (Phase 7.4 - å·²å®Œæˆ)
â”‚   â”‚   â”œâ”€â”€ StateManager.js      # UIçŠ¶æ€ç®¡ç†å™¨ (Phase 7.5 - å·²å®Œæˆ)
â”‚   â”‚   â””â”€â”€ styles/              # æ¨¡å—åŒ–æ ·å¼ (Phase 7.7 - å·²å®Œæˆ)
â”‚   â”‚       â”œâ”€â”€ index.css        # æ ·å¼å…¥å£æ–‡ä»¶
â”‚   â”‚       â”œâ”€â”€ base.css         # åŸºç¡€æ ·å¼å’ŒCSSå˜é‡
â”‚   â”‚       â”œâ”€â”€ buttons.css      # æŒ‰é’®æ ·å¼
â”‚   â”‚       â”œâ”€â”€ content-selection.css # å†…å®¹é€‰æ‹©æ ·å¼
â”‚   â”‚       â”œâ”€â”€ forms.css        # è¡¨å•æ ·å¼
â”‚   â”‚       â”œâ”€â”€ preview.css      # é¢„è§ˆæ ·å¼
â”‚   â”‚       â”œâ”€â”€ progress.css     # è¿›åº¦æ¡æ ·å¼
â”‚   â”‚       â”œâ”€â”€ tags.css         # æ ‡ç­¾æ ·å¼
â”‚   â”‚       â”œâ”€â”€ tasks.css        # ä»»åŠ¡åˆ—è¡¨æ ·å¼
â”‚   â”‚       â””â”€â”€ responsive.css   # å“åº”å¼æ ·å¼
â”‚   â”œâ”€â”€ plugins/       # å†…ç½®æ’ä»¶ (Phase 8 - è®¡åˆ’ä¸­)
â”‚   â”‚   â””â”€â”€ builtin/
â”‚   â”‚       â”œâ”€â”€ TransformersPlugin.js  # Transformerså‘é‡åŒ–æ’ä»¶
â”‚   â”‚       â”œâ”€â”€ OllamaPlugin.js        # Ollamaå‘é‡åŒ–æ’ä»¶
â”‚   â”‚       â”œâ”€â”€ vLLMPlugin.js          # vLLMå‘é‡åŒ–æ’ä»¶
â”‚   â”‚       â”œâ”€â”€ WebLLMPlugin.js        # WebLLMå‘é‡åŒ–æ’ä»¶
â”‚   â”‚       â”œâ”€â”€ OpenAIPlugin.js        # OpenAIå‘é‡åŒ–æ’ä»¶
â”‚   â”‚       â””â”€â”€ CoherePlugin.js        # Cohereå‘é‡åŒ–æ’ä»¶
â”‚   â”œâ”€â”€ legacy/        # å°†è¢«é‡æ„çš„æ—§ä»£ç 
â”‚   â”‚   â””â”€â”€ README.md
â”‚   â”œâ”€â”€ build-setup-plan.md  # æ„å»ºç¯å¢ƒè®¾ç½®è®¡åˆ’ (æ–°å¢)
â”‚   â””â”€â”€ refactoring-progress.md  # é‡æ„è¿›åº¦æŠ¥å‘Š (æ–°å¢)
â”œâ”€â”€ plugins/            # å¤–éƒ¨æ’ä»¶ç›®å½• (Phase 8 - è®¡åˆ’ä¸­)
â”‚   â””â”€â”€ example/
â”‚       â””â”€â”€ MockVectorizerPlugin.js  # ç¤ºä¾‹æ’ä»¶
â”œâ”€â”€ docs/               # æ–‡æ¡£ç›®å½• (Phase 8 - è®¡åˆ’ä¸­)
â”‚   â””â”€â”€ plugin-development.md  # æ’ä»¶å¼€å‘æŒ‡å—
â”œâ”€â”€ scripts/            # è„šæœ¬ç›®å½• (Phase 8 - è®¡åˆ’ä¸­)
â”‚   â””â”€â”€ create-plugin.js  # æ’ä»¶æ¨¡æ¿ç”Ÿæˆå™¨
â”œâ”€â”€ debug/               # è°ƒè¯•å·¥å…·ç›®å½•
â”‚   â”œâ”€â”€ debugger.js
â”‚   â”œâ”€â”€ ui-manager.js
â”‚   â”œâ”€â”€ analyzers/       # åˆ†æå·¥å…·
â”‚   â”œâ”€â”€ templates/       # UIæ¨¡æ¿
â”‚   â””â”€â”€ tools/          # è¾…åŠ©å·¥å…·
â””â”€â”€ SuperAgent/         # é¡¹ç›®ç®¡ç†ç›®å½•
    â”œâ”€â”€ tech-structure.md
    â”œâ”€â”€ project-brief.md
    â””â”€â”€ Context/
        â”œâ”€â”€ project-architecture.md
        â””â”€â”€ iterations-log.md
```

## ä¾èµ–å…³ç³»å›¾
```
å½“å‰æ¶æ„ï¼ˆé«˜åº¦è€¦åˆï¼‰ï¼š
index.js
â”œâ”€â”€> jQuery (å…¨å±€ä¾èµ–)
â”œâ”€â”€> SillyTavern API (getContext, eventSourceç­‰)
â”œâ”€â”€> å‘é‡åŒ–å¼•æ“
â”‚    â”œâ”€â”€> Transformers.js
â”‚    â”œâ”€â”€> Ollama API
â”‚    â”œâ”€â”€> vLLM API
â”‚    â””â”€â”€> WebLLM (webllm.js)
â”œâ”€â”€> UIç»„ä»¶ (settings.html)
â”‚    â””â”€â”€> src/ui/components/TagUI.js
â”œâ”€â”€> æ ·å¼ (style.css)
â””â”€â”€> è°ƒè¯•å·¥å…· (debug/*)

ç›®æ ‡æ¶æ„ï¼ˆåˆ†å±‚è§£è€¦ï¼‰ï¼š
è§ refactoring-architecture.md
```

## æ¨¡å—æè¿°

### æ ¸å¿ƒæ¨¡å—ï¼ˆå·²é‡æ„æ¨¡å—åŒ–ï¼‰
1. **è®¾ç½®ç®¡ç†**ï¼ˆå·²é‡æ„ âœ…ï¼‰
   - ConfigManagerï¼šç»Ÿä¸€é…ç½®ç®¡ç†æ¥å£
   - SettingsManagerï¼šUIè®¾ç½®åˆå§‹åŒ–å’Œäº‹ä»¶å¤„ç†
   - ä¸extension_settingsæ·±åº¦é›†æˆ

2. **å†…å®¹æå–**ï¼ˆå·²é‡æ„ âœ…ï¼‰
   - IContentExtractorï¼šç»Ÿä¸€æå–å™¨æ¥å£
   - ChatExtractorï¼šèŠå¤©æ¶ˆæ¯æå–ï¼Œé›†æˆchatUtils
   - FileExtractorï¼šæ–‡ä»¶å†…å®¹è·å–
   - WorldInfoExtractorï¼šä¸–ç•Œä¿¡æ¯è¯»å–

3. **å‘é‡åŒ–å¤„ç†**ï¼ˆå·²é‡æ„ âœ…ï¼‰
   - VectorizationAdapterï¼šå¤šå¼•æ“é€‚é…ç»Ÿä¸€æ¥å£
   - æ”¯æŒTransformers/Ollama/vLLM/WebLLM/OpenAI/Cohere
   - æ‰¹é‡å¤„ç†å’Œé”™è¯¯æ¢å¤æœºåˆ¶

4. **ä»»åŠ¡ç®¡ç†**ï¼ˆå·²é‡æ„ âœ…ï¼‰
   - TaskManagerï¼šæ–°æ—§ä»»åŠ¡ç³»ç»Ÿåè°ƒå™¨
   - TaskQueueï¼šä»»åŠ¡é˜Ÿåˆ—å’Œå¹¶å‘æ§åˆ¶
   - TaskFactoryï¼šä»»åŠ¡åˆ›å»ºå’Œæ ¼å¼è½¬æ¢
   - åŒå†™æ¨¡å¼ç¡®ä¿å‘åå…¼å®¹

5. **å‘é‡å­˜å‚¨**ï¼ˆå·²é‡æ„ âœ…ï¼‰
   - StorageAdapterï¼šå‘é‡æ•°æ®åº“CRUDç»Ÿä¸€æ¥å£
   - TaskStorageAdapterï¼šä»»åŠ¡æŒä¹…åŒ–å­˜å‚¨
   - ä¾èµ–æ³¨å…¥é¿å…å¾ªç¯å¼•ç”¨

6. **å†…å®¹æ³¨å…¥**ï¼ˆéƒ¨åˆ†é‡æ„ï¼‰
   - ç›¸ä¼¼åº¦åŒ¹é…ï¼ˆä¿æŒåŸæœ‰é€»è¾‘ï¼‰
   - æ³¨å…¥ä½ç½®è®¡ç®—ï¼ˆä¿æŒåŸæœ‰é€»è¾‘ï¼‰
   - æ ‡ç­¾ç³»ç»Ÿï¼ˆå·²é‡æ„TagExtractor/TagParser/TagScannerï¼‰

7. **UIäº¤äº’**ï¼ˆå·²é‡æ„ âœ…ï¼‰
   - ç»„ä»¶åŒ–UIï¼šTaskList/FileList/WorldInfoListç­‰
   - domUtilsï¼šç»Ÿä¸€DOMæ“ä½œ
   - MessageUIï¼šæ¶ˆæ¯ç›¸å…³UIé€»è¾‘
   - TagUIï¼šæ ‡ç­¾ç›¸å…³UIç®¡ç†

### UI æ¨¡å— (Phase 7é‡æ„)
- **src/ui/domUtils.js**: å°è£…æ‰€æœ‰DOMæ“ä½œï¼Œæ—¨åœ¨å°†UIé€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»ã€‚ç›®å‰å·²åŒ…å«ï¼š
  - åŸºç¡€UIçŠ¶æ€ç®¡ç†ï¼š`updateContentSelection`, `updateMasterSwitchState`, `toggleSettings`
  - è¿›åº¦æ˜¾ç¤ºï¼š`hideProgress`, `updateProgress`
  - æ–‡ä»¶æ“ä½œï¼š`triggerDownload` (å°è£…äº†åŸç”ŸDOMæ–‡ä»¶ä¸‹è½½é€»è¾‘)
- **src/ui/settingsManager.js**: é›†ä¸­ç®¡ç†æ‰€æœ‰è®¾ç½®ç›¸å…³çš„UIåˆå§‹åŒ–å’Œäº‹ä»¶å¤„ç†
  - ä» index.js çš„ jQuery ready å¤„ç†å™¨ä¸­æå–äº†çº¦373è¡Œè®¾ç½®åˆå§‹åŒ–ä»£ç 
  - ä½¿ç”¨ SettingsManager ç±»ç»„ç»‡æ‰€æœ‰è®¾ç½®çš„åˆå§‹åŒ–é€»è¾‘
  - é€šè¿‡ ConfigManager å¤„ç†è®¾ç½®çš„æŒä¹…åŒ–
  - Phase 9.3: æ·»åŠ å®éªŒæ€§è®¾ç½®ç®¡ç†ï¼ˆç®¡é“å¼€å…³ï¼‰
- **src/ui/components/**: å­˜æ”¾å¯å¤ç”¨çš„UIç»„ä»¶
- **src/ui/ProgressManager.js**: é›†ä¸­è¿›åº¦æ¡ç®¡ç†ï¼ˆPhase 7.3ï¼‰
- **src/ui/EventManager.js**: UIäº‹ä»¶åè°ƒå™¨ï¼ˆPhase 7.4ï¼‰
- **src/ui/StateManager.js**: UIçŠ¶æ€ç®¡ç†å™¨ï¼ˆPhase 7.5ï¼‰

### æ–‡æœ¬å¤„ç†ç®¡é“æ¨¡å— (Phase 9å·²å®Œæˆ)
- **src/core/pipeline/ITextProcessor.js**: æ–‡æœ¬å¤„ç†å™¨æŠ½è±¡æ¥å£ï¼Œæ”¯æŒç”Ÿå‘½å‘¨æœŸç®¡ç†
- **src/core/pipeline/TextPipeline.js**: æ ¸å¿ƒç®¡é“ï¼Œé›†æˆä¸­é—´ä»¶ã€ç”Ÿå‘½å‘¨æœŸå’Œäº‹ä»¶ç³»ç»Ÿ
- **src/core/pipeline/ProcessorRegistry.js**: å¤„ç†å™¨æ³¨å†Œè¡¨
- **src/core/pipeline/TextDispatcher.js**: è·¯ç”±æ–‡æœ¬åˆ°åˆé€‚çš„å¤„ç†å™¨
- **src/core/pipeline/ProcessingContext.js**: æºå¸¦ä¸Šä¸‹æ–‡ä¿¡æ¯
- **src/core/pipeline/processors/VectorizationProcessor.js**: å‘é‡åŒ–å¤„ç†å™¨åŒ…è£…å™¨ï¼ˆPhase 9.2ï¼‰
- **src/core/pipeline/adapters/ExtractorPipeline.js**: å†…å®¹æå–å™¨ç®¡é“é€‚é…å™¨ï¼ˆPhase 9.2ï¼‰
- **src/core/pipeline/ProcessorFactory.js**: å¤„ç†å™¨å·¥å‚ï¼ˆPhase 9.2ï¼‰
- **src/core/pipeline/PipelineIntegration.js**: ç®¡é“é›†æˆåŠ©æ‰‹ï¼ˆPhase 9.2ï¼‰

#### ä¸­é—´ä»¶ç³»ç»Ÿ (Phase 9.4.1)
- **src/core/pipeline/middleware/IMiddleware.js**: ä¸­é—´ä»¶æ¥å£å®šä¹‰
- **src/core/pipeline/middleware/LoggingMiddleware.js**: æ—¥å¿—è®°å½•ä¸­é—´ä»¶
- **src/core/pipeline/middleware/ValidationMiddleware.js**: è¾“å…¥éªŒè¯ä¸­é—´ä»¶
- **src/core/pipeline/middleware/TransformMiddleware.js**: æ•°æ®è½¬æ¢ä¸­é—´ä»¶
- **src/core/pipeline/MiddlewareManager.js**: ä¸­é—´ä»¶ç®¡ç†å™¨

#### ç”Ÿå‘½å‘¨æœŸç®¡ç† (Phase 9.4.2)
- **src/core/pipeline/LifecycleManager.js**: å¤„ç†å™¨å’Œä¸­é—´ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†
- **æ‰©å±•çš„ITextProcessor**: æ”¯æŒstart/stop/pause/resume/healthCheckç­‰ç”Ÿå‘½å‘¨æœŸæ–¹æ³•

#### äº‹ä»¶ç³»ç»Ÿ (Phase 9.4.3)
- **src/core/pipeline/events/PipelineEventBus.js**: ç®¡é“ä¸“ç”¨äº‹ä»¶æ€»çº¿
- **src/core/pipeline/events/EventListenerFactory.js**: äº‹ä»¶ç›‘å¬å™¨å·¥å‚
- **é›†æˆäº‹ä»¶æ”¯æŒ**: TextPipelineå’ŒLifecycleManagerå®Œå…¨é›†æˆäº‹ä»¶ç³»ç»Ÿ

### å¹¶è¡Œå®ç°ç­–ç•¥ (Phase 9.3)
- **performVectorizationPipeline**: æ–°çš„ç®¡é“ç‰ˆæœ¬å‘é‡åŒ–å‡½æ•°
- **settings.use_pipeline**: åŠŸèƒ½å¼€å…³æ ‡å¿—
- **å®éªŒæ€§åŠŸèƒ½UI**: åœ¨settings-modular.htmlä¸­æ·»åŠ äº†ç®¡é“å¼€å…³
- **A/Bæµ‹è¯•æ”¯æŒ**: window.vectorsPipelineABTest()å…¨å±€å‡½æ•°
- **å®‰å…¨é™çº§**: å‡ºé”™æ—¶è‡ªåŠ¨å›é€€åˆ°åŸå®ç°
  - **ActionButtons.js**: ä¸»è¦æ“ä½œæŒ‰é’®ç»„ä»¶ (Phase 7.1æ–°å¢)
    - é›†ä¸­ç®¡ç†Preview/Export/Vectorize/AbortæŒ‰é’®å¤„ç†é€»è¾‘
    - ç»Ÿä¸€æŒ‰é’®çŠ¶æ€ç®¡ç†å’Œé”™è¯¯å¤„ç†
    - æ™ºèƒ½æŒ‰é’®åˆ‡æ¢(å‘é‡åŒ–â†”ä¸­æ–­)
  - **SettingsPanel.js**: è®¾ç½®é¢æ¿æ¶æ„ç»„ä»¶ (Phase 7.2æ–°å¢)
    - ç»Ÿä¸€æ¨¡æ¿åŠ è½½å’Œå­ç»„ä»¶åè°ƒ
    - æä¾›å­ç»„ä»¶ç®¡ç†æ¥å£
  - **VectorizationSettings.js**: å‘é‡åŒ–è®¾ç½®ç»„ä»¶ (Phase 7.2æ–°å¢)
    - å‘é‡åŒ–æºé€‰æ‹©(Transformers/vLLM/Ollama)
    - æ¨¡å‹é…ç½®å’Œå‚æ•°è®¾ç½®
    - æºé…ç½®éªŒè¯å’Œè”åŠ¨é€»è¾‘
  - **QuerySettings.js**: æŸ¥è¯¢è®¾ç½®ç»„ä»¶ (Phase 7.2æ–°å¢)
    - Reranké…ç½®ç®¡ç†
    - APIå‚æ•°éªŒè¯
    - è®¾ç½®çŠ¶æ€åŒæ­¥
  - **InjectionSettings.js**: æ³¨å…¥è®¾ç½®ç»„ä»¶ (Phase 7.2æ–°å¢)
    - æ³¨å…¥æ¨¡æ¿å’Œä½ç½®é…ç½®
    - å†…å®¹æ ‡ç­¾ç®¡ç†
    - æ·±åº¦è®¾ç½®æ§åˆ¶
  - **ProgressManager.js**: è¿›åº¦æ¡ç®¡ç†å™¨ (Phase 7.3æ–°å¢)
    - é›†ä¸­ç®¡ç†æ‰€æœ‰è¿›åº¦æ¡æ˜¾ç¤ºé€»è¾‘
    - å¤„ç†å‘é‡åŒ–è¿‡ç¨‹ä¸­çš„é˜¶æ®µæ€§è¿›åº¦æ›´æ–°
    - è‡ªåŠ¨éšè—è¿›åº¦æ¡çš„bugä¿®å¤
  - **EventManager.js**: äº‹ä»¶ç®¡ç†å™¨ (Phase 7.4æ–°å¢)
    - é›†ä¸­ç®¡ç†æ‰€æœ‰äº‹ä»¶ç»‘å®šé€»è¾‘
    - ä½¿ç”¨å§”æ‰˜äº‹ä»¶å¤„ç†åŠ¨æ€å†…å®¹
    - ä¿®å¤äº†äº‹ä»¶ç»‘å®šä¸¢å¤±çš„é—®é¢˜
  - **StateManager.js**: UIçŠ¶æ€ç®¡ç†å™¨ (Phase 7.5æ–°å¢)
    - é›†ä¸­ç®¡ç†UIå…ƒç´ çš„å¯ç”¨/ç¦ç”¨çŠ¶æ€
    - å¤„ç†å‘é‡åŒ–è¿‡ç¨‹ä¸­çš„æŒ‰é’®çŠ¶æ€åˆ‡æ¢
    - ç»Ÿä¸€çš„çŠ¶æ€åŒæ­¥æœºåˆ¶
  - **MessageUI.js**: ç®¡ç†ä¸æ¶ˆæ¯æ˜¾ç¤ºç›¸å…³çš„UIé€»è¾‘ï¼Œå¦‚éšè—æ¶ˆæ¯æç¤ºã€å†…å®¹é¢„è§ˆå¼¹çª—ç­‰
  - **ChatSettings.js**: èŠå¤©è®¾ç½®UIç»„ä»¶
  - **TagRulesEditor.js**: æ ‡ç­¾è§„åˆ™ç¼–è¾‘å™¨UIç»„ä»¶
  - **TaskList.js**: ä»»åŠ¡åˆ—è¡¨UIç»„ä»¶
  - **FileList.js**: æ–‡ä»¶åˆ—è¡¨UIç»„ä»¶
  - **WorldInfoList.js**: ä¸–ç•Œä¿¡æ¯åˆ—è¡¨UIç»„ä»¶
  - **TagUI.js**: æ ‡ç­¾ç›¸å…³UIé€»è¾‘ç®¡ç†

### è¾…åŠ©æ¨¡å—
- **webllm.js**: WebLLMå¼•æ“çš„ç®€å•å°è£…
- **debug/**: å¼€å‘è°ƒè¯•å·¥å…·é›†
- **src/utils/tagScanner.js**: åŒ…å« `scanTextForTags` å‡½æ•°ï¼Œè´Ÿè´£åœ¨UIä¸­æ‰«æå’Œè¯†åˆ«æ–‡æœ¬ä¸­çš„æ ‡ç­¾ï¼Œä»¥ä¾¿è¿›è¡Œé«˜äº®æˆ–å…¶ä»–ç•Œé¢æ“ä½œã€‚
- **src/utils/tagParser.js**: æä¾›è§£ææ ‡ç­¾é…ç½®çš„å·¥å…·å‡½æ•°ï¼Œç‰¹åˆ«æ˜¯å¤„ç†å¸¦æœ‰æ’é™¤è§„åˆ™çš„å¤æ‚æ ‡ç­¾å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ "include,tags - exclude,tags"ï¼‰ã€‚
- **src/utils/chatUtils.js**: ç»Ÿä¸€çš„æ¶ˆæ¯è¿‡æ»¤å·¥å…·ï¼Œæä¾› `getMessages` ç­‰å‡½æ•°ï¼Œæ¶ˆé™¤äº†ä¹‹å‰åœ¨ UI å’Œæ•°æ®å¤„ç†å±‚çš„é‡å¤é€»è¾‘ã€‚
- **src/infrastructure/storage/StorageAdapter.js**: å­˜å‚¨é€‚é…å™¨ï¼Œå°è£…æ‰€æœ‰å‘é‡å­˜å‚¨ç›¸å…³çš„ API è°ƒç”¨ï¼Œä½¿ç”¨ä¾èµ–æ³¨å…¥æ¨¡å¼é¿å…å¾ªç¯å¼•ç”¨ã€‚
- **src/infrastructure/api/VectorizationAdapter.js**: å‘é‡åŒ– API é€‚é…å™¨ï¼Œç»Ÿä¸€å°è£…æ‰€æœ‰å‘é‡åŒ–æºï¼ˆTransformersã€Ollamaã€vLLMã€WebLLMã€OpenAIã€Cohereï¼‰çš„è°ƒç”¨æ¥å£ã€‚

### ä»»åŠ¡ç³»ç»Ÿæ¨¡å— (Phase 6 å®Œæˆ)
- **src/core/tasks/**: ä»»åŠ¡ç³»ç»Ÿæ ¸å¿ƒ
  - **ITask.js**: ä»»åŠ¡æ¥å£å®šä¹‰ï¼Œè§„èŒƒæ‰€æœ‰ä»»åŠ¡çš„åŸºæœ¬æ–¹æ³•
  - **BaseTask.js**: åŸºç¡€ä»»åŠ¡ç±»ï¼Œæä¾›é€šç”¨ä»»åŠ¡åŠŸèƒ½å’ŒçŠ¶æ€ç®¡ç†
  - **VectorizationTask.js**: å‘é‡åŒ–ä»»åŠ¡å®ç°ï¼Œæ”¯æŒæ–°æ—§æ ¼å¼è½¬æ¢
  - **TaskFactory.js**: ä»»åŠ¡å·¥å‚ï¼Œè´Ÿè´£ä»»åŠ¡åˆ›å»ºã€ç±»å‹è¯†åˆ«å’Œæ ¼å¼è½¬æ¢
- **src/application/**: åº”ç”¨å±‚æœåŠ¡
  - **TaskManager.js**: ä»»åŠ¡ç®¡ç†å™¨ï¼Œåè°ƒæ–°æ—§ä»»åŠ¡ç³»ç»Ÿï¼Œå®ç°åŒå†™æ¨¡å¼
  - **TaskQueue.js**: ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ”¯æŒä¼˜å…ˆçº§ã€å¹¶å‘æ§åˆ¶å’Œå–æ¶ˆæœºåˆ¶
- **src/infrastructure/storage/TaskStorageAdapter.js**: ä»»åŠ¡å­˜å‚¨é€‚é…å™¨ï¼Œå¤„ç†æ–°æ—§æ ¼å¼ä»»åŠ¡çš„æŒä¹…åŒ–

### å†…å®¹æå–ç³»ç»Ÿ (Phase 5 å®Œæˆ)
- **src/core/extractors/**: å†…å®¹æå–å™¨ç³»ç»Ÿ
  - **IContentExtractor.js**: æå–å™¨ç»Ÿä¸€æ¥å£
  - **ChatExtractor.js**: èŠå¤©æ¶ˆæ¯æå–å™¨ï¼Œé›†æˆç»Ÿä¸€çš„æ¶ˆæ¯è¿‡æ»¤é€»è¾‘
  - **FileExtractor.js**: æ–‡ä»¶å†…å®¹æå–å™¨ï¼Œå¤„ç†å„ç§æ–‡ä»¶æ ¼å¼
  - **WorldInfoExtractor.js**: ä¸–ç•Œä¿¡æ¯æå–å™¨ï¼ŒæŒ‰ä¸–ç•Œå’Œæ¡ç›®ç»„ç»‡å†…å®¹

## é‡æ„è¿›å±•çŠ¶æ€

### å·²è§£å†³çš„æ¶æ„é—®é¢˜ âœ…
1. **å•ä¸€èŒè´£è¿å**: å·²é€šè¿‡æ¨¡å—åŒ–é‡æ„å¤§å¹…æ”¹å–„
   - UIé€»è¾‘è¿ç§»è‡³ `src/ui/components/`
   - ä¸šåŠ¡é€»è¾‘è¿ç§»è‡³ `src/core/`
   - åŸºç¡€è®¾æ–½è¿ç§»è‡³ `src/infrastructure/`

2. **é«˜è€¦åˆåº¦**: å·²å¤§å¹…æ”¹å–„
   - UIä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»ï¼ˆdomUtilsã€å„UIç»„ä»¶ï¼‰
   - ä¾èµ–æ³¨å…¥æ¨¡å¼é¿å…å¾ªç¯å¼•ç”¨
   - é€‚é…å™¨æ¨¡å¼ç»Ÿä¸€å¤–éƒ¨æ¥å£

3. **æ‰©å±•å›°éš¾**: å·²è§£å†³
   - æ’ä»¶å¼æ¶æ„ï¼ˆæå–å™¨ã€ä»»åŠ¡ã€é€‚é…å™¨ï¼‰
   - å·¥å‚æ¨¡å¼æ”¯æŒæ–°ç±»å‹æ‰©å±•
   - ç»Ÿä¸€æ¥å£ä¾¿äºåŠŸèƒ½æ·»åŠ 

4. **æµ‹è¯•å›°éš¾**: å·²å¤§å¹…æ”¹å–„
   - æ¨¡å—åŒ–ä»£ç ä¾¿äºå•å…ƒæµ‹è¯•
   - ä¾èµ–æ³¨å…¥æ”¯æŒMockæµ‹è¯•
   - æ¥å£è§„èŒƒåŒ–

5. **ä»£ç é‡å¤**: å·²è§£å†³
   - ç»Ÿä¸€å·¥å…·å‡½æ•°ï¼ˆchatUtilsã€tagExtractorç­‰ï¼‰
   - å¤ç”¨ç»„ä»¶ï¼ˆUI componentsï¼‰
   - ç»Ÿä¸€é€‚é…å™¨æ¨¡å¼

6. **æ¶ˆæ¯è¿‡æ»¤é€»è¾‘ä¸ä¸€è‡´**: å·²è§£å†³ âœ…
   - åˆ›å»ºç»Ÿä¸€çš„ `chatUtils.js` æ¨¡å—
   - æ‰€æœ‰æ¶ˆæ¯è¿‡æ»¤ä½¿ç”¨ç»Ÿä¸€æ¥å£
   - æ¶ˆé™¤äº†UIå’Œæ•°æ®å±‚çš„é‡å¤é€»è¾‘

### Bugä¿®å¤è®°å½•
1. **EventManageräº‹ä»¶ç»‘å®šé—®é¢˜**: å·²ä¿®å¤ âœ…
   - é—®é¢˜ï¼šåŠ¨æ€ç”Ÿæˆçš„ä»»åŠ¡åˆ—è¡¨é¡¹æŒ‰é’®äº‹ä»¶ç»‘å®šå¤±æ•ˆ
   - åŸå› ï¼šä½¿ç”¨ç›´æ¥äº‹ä»¶ç»‘å®šè€Œéå§”æ‰˜äº‹ä»¶
   - è§£å†³ï¼šæ”¹ç”¨jQueryå§”æ‰˜äº‹ä»¶å¤„ç†åŠ¨æ€å†…å®¹

2. **è¿›åº¦æ¡è‡ªåŠ¨éšè—é—®é¢˜**: å·²ä¿®å¤ âœ…
   - é—®é¢˜ï¼šå‘é‡åŒ–å®Œæˆåè¿›åº¦æ¡æœªè‡ªåŠ¨éšè—
   - åŸå› ï¼šProgressManageræœªæ­£ç¡®è°ƒç”¨hideProgress
   - è§£å†³ï¼šåœ¨å¤„ç†ç»“æŸæ—¶ç¡®ä¿è°ƒç”¨éšè—æ–¹æ³•

3. **ä»»åŠ¡åç§°é€»è¾‘é—®é¢˜**: å·²ä¿®å¤ âœ…
   - é—®é¢˜ï¼šä»»åŠ¡åç§°æ˜¾ç¤ºä¸æ­£ç¡®
   - åŸå› ï¼šä½¿ç”¨äº†é”™è¯¯çš„å±æ€§å
   - è§£å†³ï¼šç»Ÿä¸€ä½¿ç”¨task.nameå±æ€§

### æ€§èƒ½ä¼˜åŒ–è®°å½•
1. **ä»£ç å»é‡åˆ†æ**: å·²å®Œæˆ âœ…
   - åˆ›å»ºäº†deduplication-analysis.mdæ–‡æ¡£
   - è¯†åˆ«äº†6ä¸ªä¸»è¦é‡å¤åŒºåŸŸ
   - è®¡åˆ’é€šè¿‡æ¨¡å—åŒ–å‡å°‘çº¦30-40%çš„ä»£ç é‡

### å¾…å®Œæˆçš„æ¶æ„æ”¹è¿›
1. **å®Œå…¨æ¨¡å—åŒ–å…¥å£**: åˆ›å»ºæ–°çš„æ¨¡å—åŒ–å…¥å£æ–‡ä»¶
2. **æ’ä»¶ç³»ç»Ÿ**: å®ç°å®Œæ•´çš„æ’ä»¶æ¶æ„
3. **æ ·å¼æ¨¡å—åŒ–**: CSSæ‹†åˆ†å’Œç»„ç»‡
4. **æ€§èƒ½ä¼˜åŒ–**: ç¼“å­˜å’Œæ‰¹å¤„ç†ä¼˜åŒ–

## å½“å‰ç³»ç»ŸçŠ¶æ€

### TaskManagerç³»ç»Ÿè¿è¡ŒçŠ¶æ€
- **è¿è¡Œæ¨¡å¼**: TaskManagerï¼ˆæ–°ä»»åŠ¡ç³»ç»Ÿï¼‰
- **å‘åå…¼å®¹**: å®Œå…¨ä¿æŒï¼Œæ‰€æœ‰ç°æœ‰ä»»åŠ¡æ­£å¸¸è®¿é—®
- **ç³»ç»Ÿå¥åº·**: å…¨éƒ¨æ¨¡å—æ­£å¸¸è¿è¡Œ
- **çŠ¶æ€æ£€æŸ¥**: ä½¿ç”¨ `vectorsTaskSystemStatus()` å¯æŸ¥çœ‹è¯¦ç»†çŠ¶æ€

### é‡æ„å®Œæˆåº¦
- **Phase 0-1**: åŸºç¡€è®¾æ–½å±‚ âœ… 100%
- **Phase 2**: æ ¸å¿ƒå®ä½“ âœ… 100% 
- **Phase 3**: å·¥å…·å‡½æ•°æå– âœ… 100%
- **Phase 4**: é€‚é…å™¨å±‚ âœ… 100%
- **Phase 5**: å†…å®¹æå–å™¨ âœ… 100%
- **Phase 6**: ä»»åŠ¡ç³»ç»Ÿ âœ… 100%
- **Phase 7**: UIå±‚é‡æ„ âœ… 95% (ActionButtons + SettingsPanelæ¶æ„ + ProgressManager/EventManager/StateManagerå®Œæˆ)
- **Phase 8**: ä»»åŠ¡ç³»ç»Ÿå…¼å®¹æ€§æ‰©å±• ğŸ“‹ å¾…å®æ–½
- **Phase 9**: æ–‡æœ¬å¤„ç†ç®¡é“ âœ… 100%
  - **Phase 9.1**: ç®¡é“æ¶æ„åŸºç¡€ âœ… 100%
  - **Phase 9.2**: é€‚é…å™¨æ¨¡å¼é›†æˆ âœ… 100%
  - **Phase 9.3**: å¹¶è¡Œå®ç° âœ… 100%
  - **Phase 9.4**: æ‰©å±•æ€§æ”¯æŒ âœ… 100%
    - **Phase 9.4.1**: ä¸­é—´ä»¶ç³»ç»Ÿ âœ… 100%
    - **Phase 9.4.2**: ç”Ÿå‘½å‘¨æœŸç®¡ç† âœ… 100%
    - **Phase 9.4.3**: äº‹ä»¶æ”¯æŒ âœ… 100%
- **Phase 9.5**: å®‰å…¨éªŒè¯å’Œè¿ç§» ğŸ“‹ å¾…å®æ–½
- **Phase 10**: æ¶æ„åˆ‡æ¢ ğŸ“‹ å¾…å®æ–½  
- **Phase 11**: æ¸…ç†ä¼˜åŒ–å’Œæ–°åŠŸèƒ½ ğŸ“‹ å¾…å®æ–½

### å…³é”®ç‰¹æ€§
1. **åŒç³»ç»Ÿå…¼å®¹**: æ–°ä»»åŠ¡ç³»ç»Ÿä¸legacyç³»ç»Ÿå®Œç¾å…±å­˜
2. **é›¶åœæœºè¿ç§»**: é‡æ„è¿‡ç¨‹ä¸­åŠŸèƒ½å§‹ç»ˆå¯ç”¨
3. **æ¸è¿›å¼æ¶æ„**: æ¯ä¸ªé˜¶æ®µéƒ½æ˜¯å¯ç‹¬ç«‹éªŒè¯çš„æ”¹è¿›
4. **å‘åå…¼å®¹**: æ‰€æœ‰ç°æœ‰æ•°æ®å’ŒåŠŸèƒ½å®Œå…¨ä¿ç•™
