# Vectors Enhanced æ’ä»¶æ¶æ„æ–‡æ¡£

## ä¸€ã€å½“å‰æ¶æ„çŠ¶æ€ï¼ˆPhase 8 åï¼‰

### 1.1 æ ¸å¿ƒå±‚ (core/)

#### å®ä½“å±‚ (entities/)
- âœ… **Content** - å†…å®¹å®ä½“ï¼Œè¡¨ç¤ºæå–çš„æ–‡æœ¬
- âœ… **Vector** - å‘é‡å®ä½“ï¼Œè¡¨ç¤ºå‘é‡åŒ–ç»“æœ
- âœ… **Task** - ä»»åŠ¡å®ä½“ï¼Œæ”¯æŒç‰ˆæœ¬ç®¡ç†

#### æå–å™¨å±‚ (extractors/)
- âœ… **IContentExtractor** - ç»Ÿä¸€æå–å™¨æ¥å£
- âœ… **ChatExtractor** - èŠå¤©æ¶ˆæ¯æå–
- âœ… **FileExtractor** - æ–‡ä»¶å†…å®¹æå–
- âœ… **WorldInfoExtractor** - ä¸–ç•Œä¿¡æ¯æå–

#### ä»»åŠ¡ç³»ç»Ÿ (tasks/)
- âœ… **BaseTask** - ä»»åŠ¡åŸºç±»ï¼ˆv1.0 ç‰ˆæœ¬æ”¯æŒï¼‰
- âœ… **VectorizationTask** - å‘é‡åŒ–ä»»åŠ¡å®ç°
- âœ… **TaskFactory** - ä»»åŠ¡å·¥å‚ï¼ˆæ”¯æŒç±»å‹æ³¨å†Œï¼‰
- âš ï¸ **ç¼ºå¤±** - å…¶ä»–ä»»åŠ¡ç±»å‹ï¼ˆRerankã€Summaryç­‰ï¼‰

### 1.2 åŸºç¡€è®¾æ–½å±‚ (infrastructure/)

#### äº‹ä»¶ç³»ç»Ÿ (events/)
- âœ… **EventBus** - äº‹ä»¶æ€»çº¿å®ç°
- âœ… **å…¨å±€å®ä¾‹** - eventBus.instance.js

#### å­˜å‚¨å±‚ (storage/)
- âœ… **StorageAdapter** - é€šç”¨å­˜å‚¨æ¥å£
- âœ… **TaskStorageAdapter** - ä»»åŠ¡å­˜å‚¨ï¼ˆç‰ˆæœ¬å…¼å®¹ï¼‰

#### APIå±‚ (api/)
- âœ… **VectorizationAdapter** - å‘é‡åŒ–APIï¼ˆ6ç§æºï¼‰
- âš ï¸ **ç¼ºå¤±** - é€šç”¨APIæ¡†æ¶

### 1.3 åº”ç”¨å±‚ (application/)
- âœ… **TaskManager** - ä»»åŠ¡ç®¡ç†å™¨
- âœ… **TaskQueue** - ä»»åŠ¡é˜Ÿåˆ—

### 1.4 UIå±‚ (ui/)
- âœ… **ç»„ä»¶åŒ–** - å„åŠŸèƒ½UIç»„ä»¶
- âœ… **è®¾ç½®ç®¡ç†** - settingsManager
- âš ï¸ **è€¦åˆ** - ä¸ä¸»æ–‡ä»¶index.jsè€¦åˆè¾ƒæ·±

## äºŒã€å¾…å®ç°çš„æ–‡æœ¬å¤„ç†ç®¡é“æ¶æ„

### 2.1 ç®¡é“ç³»ç»Ÿè®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Sources   â”‚ --> â”‚  Extractors  â”‚ --> â”‚  Pipeline   â”‚ --> â”‚  Processors  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                    â”‚                     â”‚                     â”‚
   Chat UI            Extract Text          Route & Filter       Vectorization
   Files              Normalize             Transform           Rerank
   World Info         Validate              Dispatch            Summary
```

### 2.2 æ ¸å¿ƒç»„ä»¶è®¾è®¡

#### TextPipelineï¼ˆæ–‡æœ¬å¤„ç†ç®¡é“ï¼‰
```javascript
class TextPipeline {
    constructor() {
        this.processors = new Map();
        this.middlewares = [];
    }
    
    // æ³¨å†Œå¤„ç†å™¨
    registerProcessor(type, processor) {}
    
    // æ·»åŠ ä¸­é—´ä»¶
    use(middleware) {}
    
    // å¤„ç†æ–‡æœ¬
    async process(input) {
        // 1. æå–å†…å®¹
        // 2. åº”ç”¨ä¸­é—´ä»¶
        // 3. è·¯ç”±åˆ°å¤„ç†å™¨
        // 4. è¿”å›ç»“æœ
    }
}
```

#### ProcessorRegistryï¼ˆå¤„ç†å™¨æ³¨å†Œè¡¨ï¼‰
```javascript
class ProcessorRegistry {
    // å‘é‡åŒ–å¤„ç†å™¨
    registerVectorization(adapter) {}
    
    // Rerankå¤„ç†å™¨
    registerRerank(adapter) {}
    
    // æ€»ç»“å¤„ç†å™¨
    registerSummary(adapter) {}
    
    // è·å–å¤„ç†å™¨
    getProcessor(type, config) {}
}
```

#### TextDispatcherï¼ˆæ–‡æœ¬åˆ†å‘å™¨ï¼‰
```javascript
class TextDispatcher {
    // æ ¹æ®ä»»åŠ¡ç±»å‹åˆ†å‘
    async dispatch(content, taskType, config) {}
    
    // æ‰¹é‡åˆ†å‘
    async batchDispatch(contents, tasks) {}
    
    // é“¾å¼å¤„ç†
    async chain(content, taskChain) {}
}
```

### 2.3 é›†æˆæ–¹æ¡ˆ

#### ç¬¬ä¸€é˜¶æ®µï¼šåˆ›å»ºç®¡é“åŸºç¡€è®¾æ–½
1. å®ç° ITextProcessor æ¥å£
2. åˆ›å»º TextPipeline ç±»
3. åˆ›å»º ProcessorRegistry
4. åˆ›å»º TextDispatcher

#### ç¬¬äºŒé˜¶æ®µï¼šè¿ç§»ç°æœ‰åŠŸèƒ½
1. å°† VectorizationAdapter åŒ…è£…ä¸º VectorizationProcessor
2. åˆ›å»º ExtractorAdapter è¿æ¥ç°æœ‰æå–å™¨
3. é‡æ„ performVectorization ä½¿ç”¨ç®¡é“

#### ç¬¬ä¸‰é˜¶æ®µï¼šæ‰©å±•æ–°åŠŸèƒ½
1. å®ç° RerankProcessor
2. å®ç° SummaryProcessor
3. å®ç°ä»»åŠ¡é“¾åŠŸèƒ½

## ä¸‰ã€å®ç°è®¡åˆ’

### Phase 9: æ–‡æœ¬å¤„ç†ç®¡é“å®ç°

#### 9.1 ç®¡é“åŸºç¡€è®¾æ–½
- [ ] åˆ›å»º pipeline/ ç›®å½•ç»“æ„
- [ ] å®ç° ITextProcessor æ¥å£
- [ ] å®ç° TextPipeline æ ¸å¿ƒç±»
- [ ] å®ç° ProcessorRegistry
- [ ] å®ç° TextDispatcher

#### 9.2 é€‚é…å™¨å±‚
- [ ] åˆ›å»º VectorizationProcessor é€‚é…å™¨
- [ ] åˆ›å»º ExtractorPipeline è¿æ¥æå–å™¨
- [ ] åˆ›å»º ProcessingContext ä¸Šä¸‹æ–‡ç±»

#### 9.3 è¿ç§»ç°æœ‰åŠŸèƒ½
- [ ] é‡æ„ performVectorization ä½¿ç”¨ç®¡é“
- [ ] è¿ç§»ä»»åŠ¡åˆ›å»ºé€»è¾‘
- [ ] æ›´æ–° UI è°ƒç”¨

#### 9.4 æµ‹è¯•ä¸éªŒè¯
- [ ] ç¡®ä¿å‘é‡åŒ–åŠŸèƒ½æ­£å¸¸
- [ ] éªŒè¯ä»»åŠ¡å…¼å®¹æ€§
- [ ] æ€§èƒ½æµ‹è¯•

### Phase 10: æ–°åŠŸèƒ½å®ç°ï¼ˆæœªæ¥ï¼‰

#### 10.1 RerankåŠŸèƒ½
- [ ] å®ç° RerankTask
- [ ] å®ç° RerankProcessor
- [ ] æ·»åŠ  Rerank API é€‚é…å™¨

#### 10.2 æ€»ç»“åŠŸèƒ½
- [ ] å®ç° SummaryTask
- [ ] å®ç° SummaryProcessor
- [ ] å®ç°æç¤ºè¯æ¨¡æ¿ç³»ç»Ÿ

#### 10.3 è‡ªåŠ¨åŒ–åŠŸèƒ½
- [ ] å®ç°è§¦å‘å™¨ç³»ç»Ÿ
- [ ] å®ç°æ‰¹å¤„ç†è°ƒåº¦
- [ ] å®ç°æ¶ˆæ¯çŠ¶æ€ç®¡ç†

#### 10.4 ä»»åŠ¡å¯¼å‡º/å¯¼å…¥
- [ ] å®ç°ä»»åŠ¡åºåˆ—åŒ–
- [ ] å®ç°è·¨èŠå¤©è¿ç§»
- [ ] å®ç°æƒé™ç®¡ç†

## å››ã€æŠ€æœ¯å€ºåŠ¡å’Œæ”¹è¿›ç‚¹

### éœ€è¦è§£å†³çš„é—®é¢˜
1. **index.js è¿‡åº¦å¤æ‚** - éœ€è¦è¿›ä¸€æ­¥æ¨¡å—åŒ–
2. **UIä¸é€»è¾‘è€¦åˆ** - éœ€è¦å®Œå…¨åˆ†ç¦»
3. **ç¼ºå°‘å•å…ƒæµ‹è¯•** - éœ€è¦æ·»åŠ æµ‹è¯•æ¡†æ¶
4. **ç¼ºå°‘ç±»å‹å®šä¹‰** - è€ƒè™‘æ·»åŠ  JSDoc æˆ– TypeScript

### æ€§èƒ½ä¼˜åŒ–
1. **æ‰¹é‡å¤„ç†ä¼˜åŒ–** - å‡å°‘APIè°ƒç”¨
2. **ç¼“å­˜æœºåˆ¶** - é¿å…é‡å¤å¤„ç†
3. **å¹¶å‘æ§åˆ¶** - ä¼˜åŒ–å¤§é‡ä»»åŠ¡å¤„ç†

### å¯ç»´æŠ¤æ€§æ”¹è¿›
1. **é”™è¯¯å¤„ç†ç»Ÿä¸€** - åˆ›å»ºé”™è¯¯å¤„ç†ä¸­é—´ä»¶
2. **æ—¥å¿—ç³»ç»Ÿå¢å¼º** - æ·»åŠ æ—¥å¿—çº§åˆ«å’ŒæŒä¹…åŒ–
3. **é…ç½®ç®¡ç†æ”¹è¿›** - æ”¯æŒé…ç½®éªŒè¯å’Œè¿ç§»

## äº”ã€ç‰ˆæœ¬è§„åˆ’

### v2.0ï¼ˆå½“å‰å¼€å‘ï¼‰
- âœ… æ¨¡å—åŒ–é‡æ„
- âœ… ä»»åŠ¡ç³»ç»Ÿæ”¹é€ 
- ğŸš§ æ–‡æœ¬å¤„ç†ç®¡é“
- â³ åŸºç¡€æ–°åŠŸèƒ½

### v2.1ï¼ˆè®¡åˆ’ä¸­ï¼‰
- â³ RerankåŠŸèƒ½
- â³ æ€»ç»“åŠŸèƒ½
- â³ è‡ªåŠ¨åŒ–ä»»åŠ¡

### v2.2ï¼ˆæœªæ¥ï¼‰
- â³ ä»»åŠ¡å¯¼å‡º/å¯¼å…¥
- â³ é«˜çº§é…ç½®
- â³ æ’ä»¶æ‰©å±•ç³»ç»Ÿ