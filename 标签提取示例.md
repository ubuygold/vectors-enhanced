# 标签提取功能使用示例

## 功能概述
增强版vectors扩展现在支持强大的标签提取功能，可以精确地从聊天消息中提取特定内容进行向量化。

## 支持的标签格式

### 1. 简单标签
**配置：** `content,thinking`

**示例文本：**
```html
<content>这是重要的背景信息</content>
<thinking>这是角色的内心想法</thinking>
```

**提取结果：**
```
这是重要的背景信息

这是角色的内心想法
```

### 2. 复杂条件标签
**配置：** `<details><summary>摘要</summary>,</details>`

**示例文本：**
```html
<details><summary>摘要</summary>
这是需要提取的摘要内容
包含多行文本
<strong>重要信息</strong>
</details>

<details><summary>其他</summary>
这不会被提取</details>

```

**提取结果：**
```
这是需要提取的摘要内容
包含多行文本
<strong>重要信息</strong>
```

### 3. 自定义标签组合
**配置：** `<div><h3>重要</h3>,</div>`

**示例文本：**
```html
<div><h3>重要</h3>
<p>这是重要的段落内容</p>
<ul>
  <li>项目1</li>
  <li>项目2</li>
</ul>
</div>
```

**提取结果：**
```
<p>这是重要的段落内容</p>
<ul>
  <li>项目1</li>
  <li>项目2</li>
</ul>
```

### 4. 混合使用
**配置：** `content,<details><summary>摘要</summary>,</details>,thinking`

**示例文本：**
```html
<content>背景信息</content>

<details><summary>摘要</summary>
摘要内容
</details>

<details><summary>其他</summary>
不会被提取
</details>

<thinking>思考过程</thinking>
```

**提取结果：**
```
背景信息

摘要内容

思考过程
```

## 实际应用场景

### 场景1：角色扮演游戏
在RPG聊天中，您可能有这样的消息结构：
```html
<details><summary>行动</summary>
角色走向了森林深处，寻找传说中的宝藏。
</details>

<details><summary>内心独白</summary>
我必须小心，这里可能有危险的野兽。
</details>

<details><summary>环境描述</summary>
森林很黑，只有月光透过树叶洒下斑驳的光影。
</details>
```

**配置不同的标签提取：**
- 只提取行动：`<details><summary>行动</summary>,</details>`
- 只提取内心独白：`<details><summary>内心独白</summary>,</details>`
- 提取行动和环境：`<details><summary>行动</summary>,</details>,<details><summary>环境描述</summary>,</details>`

### 场景2：学习笔记整理
```html
<details><summary>重点</summary>
这是课程的重点内容，需要重点记忆。
</details>

<details><summary>补充</summary>
这是额外的补充信息。
</details>
```

**只向量化重点内容：** `<details><summary>重点</summary>,</details>`

### 场景3：多语言内容
```html
<div lang="zh">这是中文内容</div>
<div lang="en">This is English content</div>
```

**只提取中文：** `<div lang="zh">,</div>`

## 注意事项

1. **逗号的含义**：在复杂标签中，逗号用于分隔开始条件和结束条件，不是用于分隔多个标签
2. **内容保留**：提取的内容会保留内部的HTML标签结构
3. **条件匹配**：复杂标签只会匹配完全符合开始条件的块
4. **错误处理**：如果标签配置有误，会在控制台显示警告，但不会影响其他标签的处理
5. **向后兼容**：原有的简单标签配置继续有效，无需修改现有设置

## 高级技巧

1. **嵌套提取**：可以提取包含复杂HTML结构的内容
2. **属性匹配**：支持带CSS类或其他属性的标签匹配
3. **多任务配置**：为不同的向量化任务配置不同的标签提取规则
4. **调试模式**：在浏览器控制台查看标签匹配的详细信息

# 标签提取功能详细说明

## 概述

增强版向量化扩展支持多种标签提取格式，可以精确控制要向量化的内容。现在还支持**嵌套标签排除**和**内容过滤黑名单**功能，让您能够更精细地控制向量化内容。

## 处理顺序

内容处理按以下顺序进行：
1. **提取标签** - 根据配置提取指定标签的内容
2. **排除子标签** - 从提取的内容中移除指定的嵌套标签
3. **黑名单过滤** - 跳过包含黑名单关键词的内容块

## 支持的标签格式

### 1. 简单标签

**配置格式：** `content,thinking`

**匹配内容：**
```html
<content>这是内容部分</content>
<thinking>这是思考部分</thinking>
```

**提取结果：**
- 提取 `<content>...</content>` 中的内容
- 提取 `<thinking>...</thinking>` 中的内容

### 2. 复杂条件标签

**配置格式：** `<details><summary>摘要</summary>,</details>`

**匹配内容：**
```html
<details>
<summary>摘要</summary>
这里是摘要的具体内容
</details>

<details>
<summary>其他</summary>
这里不会被提取
</details>
```

**提取结果：**
- 只提取 `<summary>摘要</summary>` 的 `<details>` 块中的内容
- 不包含 `<details>` 和 `<summary>` 标签本身

### 3. 嵌套标签排除（新功能）

**配置格式：** `主标签 - 排除标签1,排除标签2`

**示例配置：** `content - thinking,analysis`

**原始内容：**
```html
<content>
这是重要的剧情内容
<thinking>AI的思考过程</thinking>
这里还有更多重要内容
<analysis>详细分析过程</analysis>
最后的重要信息
</content>
```

**提取结果：**
```
这是重要的剧情内容
这里还有更多重要内容
最后的重要信息
```

**说明：**
- 提取 `<content>` 标签的内容
- 但排除其中的 `<thinking>` 和 `<analysis>` 标签
- 保留其他所有内容

### 4. 复杂标签的排除语法

**配置格式：** `<details><summary>摘要</summary>,</details> - <note>,<思考>`

**原始内容：**
```html
<details>
<summary>摘要</summary>
这是重要的摘要内容
<note>这是注释，不想要</note>
更多重要内容
<思考>这是思考过程</思考>
结尾内容
</details>
```

**提取结果：**
```
这是重要的摘要内容
更多重要内容
结尾内容
```

## 内容过滤黑名单（新功能）

### 配置方式

在"内容过滤黑名单"文本框中，每行输入一个关键词或短语：

```
Step
思考过程
推理步骤
让我想想
Chain of Thought
```

### 工作原理

黑名单过滤在标签提取和排除处理**之后**进行：

1. **提取标签内容**
2. **移除排除的子标签**
3. **检查黑名单关键词**
4. **跳过包含关键词的整个内容块**

### 示例

**配置：**
- 标签：`content - thinking`
- 黑名单：`Step`, `让我想想`

**原始内容：**
```html
<content>
这是重要的剧情内容
<thinking>Step 1: 分析情况</thinking>
这里还有更多重要内容
</content>

<content>
让我想想接下来怎么办
这里有重要信息
</content>
```

**处理过程：**
1. 提取两个 `<content>` 块
2. 移除 `<thinking>` 标签
3. 第一个块：`这是重要的剧情内容\n这里还有更多重要内容`
4. 第二个块：`让我想想接下来怎么办\n这里有重要信息`
5. 黑名单过滤：第二个块包含"让我想想"，被跳过

**最终结果：**
```
这是重要的剧情内容
这里还有更多重要内容
```

## 混合使用示例

### 示例1：RPG游戏场景

**配置：**
- 标签：`<details><summary>剧情</summary>,</details> - <thinking>,<analysis>`
- 黑名单：`Step`, `推理`, `让我分析`

**用途：**
- 提取剧情摘要
- 排除AI的思考和分析过程
- 过滤包含推理步骤的内容

### 示例2：学习笔记

**配置：**
- 标签：`knowledge,summary - <draft>,<todo>`
- 黑名单：`待完善`, `需要补充`

**用途：**
- 提取知识点和总结
- 排除草稿和待办事项
- 过滤未完成的内容

### 示例3：多语言内容

**配置：**
- 标签：`<content lang="zh">,</content> - <translation>`
- 黑名单：`翻译中`, `Translation`

**用途：**
- 只提取中文内容
- 排除翻译标记
- 过滤正在翻译的内容

## 预览功能

使用预览功能时，会显示详细的处理统计：

- **原始提取块数**：按标签配置提取到的总块数
- **嵌套标签排除**：被排除语法移除的块数
- **黑名单过滤**：被黑名单关键词跳过的块数
- **最终向量化**：实际会被向量化的块数

这帮助您了解过滤效果，优化配置。

## 注意事项

1. **语法严格性**：排除语法中的 ` - ` （空格-空格）是必需的分隔符
2. **大小写敏感**：黑名单关键词不区分大小写
3. **处理顺序**：排除 → 黑名单 → 向量化
4. **错误容错**：单个标签配置错误不会影响其他标签的处理
5. **性能考虑**：复杂的排除和黑名单配置会增加处理时间

## 实际应用场景

### 场景1：过滤AI思维链

**问题：** AI输出包含大量思维链，污染向量化内容

**解决方案：**
```
标签：content
黑名单：
Step
思维链
Chain of Thought
让我思考
分析过程
```

### 场景2：提取纯剧情内容

**问题：** 消息中混合了剧情和OOC讨论

**解决方案：**
```
标签：story - <ooc>,<meta>
黑名单：
OOC
元游戏
讨论
```

### 场景3：多角色对话整理

**问题：** 需要排除某些角色的对话

**解决方案：**
```
标签：dialogue - <character name="不想要的角色">
黑名单：
旁白
系统提示
```

这些功能让您能够精确控制向量化内容，确保只有真正有价值的信息被存储和检索。 